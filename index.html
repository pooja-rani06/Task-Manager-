<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Task Manager (Offline Mode)</title>
  <style>
    /* --- same styling as your original --- */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:1200px;margin:0 auto}
    .header{background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);text-align:center;margin-bottom:30px}
    .header h1{color:#667eea;font-size:2.5em;margin-bottom:10px}
    .main-content{display:grid;grid-template-columns:300px 1fr;gap:20px}
    .sidebar{background:white;padding:20px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);height:fit-content;position:sticky;top:20px}
    .menu-item{padding:15px;margin:10px 0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:10px;cursor:pointer;width:100%;font-size:1em;transition:transform 0.2s,box-shadow 0.2s}
    .menu-item:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.4)}
    .menu-item.active{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%)}
    .content-area{background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);min-height:500px}
    .section{display:none}.section.active{display:block;animation:fadeIn .3s}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;margin-bottom:8px;color:#333;font-weight:600}
    .form-group input,.form-group textarea,.form-group select{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:1em;transition:border-color .3s}
    .btn{padding:12px 30px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;transition:transform .2s,box-shadow .2s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.4)}
    .btn-danger{background:linear-gradient(135deg,#f5576c 0%,#f093fb 100%)}
    .btn-success{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%)}
    .task-card{background:#f8f9fa;padding:20px;border-radius:10px;margin-bottom:15px;border-left:5px solid #667eea;transition:transform .2s,box-shadow .2s}
    .task-card:hover{transform:translateX(5px);box-shadow:0 5px 15px rgba(0,0,0,0.1)}
    .task-card.completed{opacity:.7;border-left-color:#38ef7d}
    .task-card.overdue{border-left-color:#f5576c}
    .task-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .task-title{font-size:1.3em;font-weight:600;color:#333}
    .task-priority{padding:5px 15px;border-radius:20px;font-size:.9em;font-weight:600}
    .priority-1{background:#ff6b6b;color:white}.priority-2{background:#ffa726;color:white}.priority-3{background:#ffd54f;color:#333}.priority-4{background:#66bb6a;color:white}.priority-5{background:#42a5f5;color:white}
    .task-meta{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:10px;padding-top:10px;border-top:1px solid #e0e0e0}
    .task-meta-item{font-size:.9em;color:#666}.task-meta-item strong{color:#333}
    .notification{position:fixed;top:20px;right:20px;padding:15px 25px;background:white;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:1000;animation:slideIn .3s}
    @keyframes slideIn{from{transform:translateX(400px)}to{transform:translateX(0)}}
    .notification.success{border-left:5px solid #38ef7d}.notification.error{border-left:5px solid #f5576c}
    .empty-state{text-align:center;padding:60px 20px;color:#999}
    @media(max-width:768px){.main-content{grid-template-columns:1fr}.sidebar{position:static}}
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìã Smart Task Manager (Offline Mode)</h1>
    <p>All tasks stored in your browser ‚Äî no server needed!</p>
  </div>

  <div class="main-content">
    <div class="sidebar">
      <button class="menu-item active" onclick="showSection('add', event)">‚ûï Add New Task</button>
      <button class="menu-item" onclick="showSection('all', event)">üìù All Tasks</button>
      <button class="menu-item" onclick="showSection('pending', event)">‚è≥ Pending</button>
      <button class="menu-item" onclick="showSection('stats', event)">üìä Stats</button>
      <button class="menu-item" onclick="showSection('sort', event)">üîÑ Sort</button>
      <button class="menu-item" onclick="undo()">‚Ü© Undo</button>
      <button class="menu-item" onclick="redo()">‚Ü™ Redo</button>
    </div>

    <div class="content-area">
      <div id="add" class="section active">
        <h2>Add New Task</h2>
        <form id="addTaskForm" onsubmit="addTask(event)">
          <div class="form-group">
            <label>Task Name *</label>
            <input type="text" id="taskName" required>
          </div>
          <div class="form-group">
            <label>Description *</label>
            <textarea id="taskDesc" required></textarea>
          </div>
          <div class="form-group">
            <label>Priority *</label>
            <select id="taskPriority">
              <option value="1">1 - Critical</option>
              <option value="2">2 - High</option>
              <option value="3" selected>3 - Medium</option>
              <option value="4">4 - Low</option>
              <option value="5">5 - Very Low</option>
            </select>
          </div>
          <div class="form-group">
            <label>Duration (mins) *</label>
            <input type="number" id="taskDuration" min="1" required>
          </div>
          <div class="form-group">
            <label>Deadline (hours from now)</label>
            <input type="number" id="taskHours" min="1" required>
          </div>
          <button type="submit" class="btn">Add Task</button>
        </form>
      </div>

      <div id="all" class="section"><h2>All Tasks</h2><div id="allTasksList"></div></div>
      <div id="pending" class="section"><h2>Pending Tasks</h2><div id="pendingTasksList"></div></div>
      <div id="stats" class="section"><h2>Statistics</h2><div id="statsContent"></div></div>
      <div id="sort" class="section">
        <h2>Sort Tasks</h2>
        <div style="display:flex;gap:10px;margin-bottom:20px;">
          <button class="btn" onclick="sortTasks('priority')">By Priority</button>
          <button class="btn" onclick="sortTasks('deadline')">By Deadline</button>
          <button class="btn" onclick="sortTasks('duration')">By Duration</button>
        </div>
        <div id="sortedTasksList"></div>
      </div>
    </div>
  </div>
</div>

<script>
let undoStack = [], redoStack = [];

function loadTasks(){ return JSON.parse(localStorage.getItem('tasks')||'[]'); }
function saveTasks(t){ localStorage.setItem('tasks', JSON.stringify(t)); }

function pushUndo(){
  undoStack.push(loadTasks());
  if(undoStack.length>20) undoStack.shift();
  redoStack=[];
}

function showNotification(msg,type='success'){
  const n=document.createElement('div');
  n.className=`notification ${type}`;
  n.textContent=msg;
  document.body.appendChild(n);
  setTimeout(()=>n.remove(),3000);
}

function showSection(id,e){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(e) e.target.classList.add('active');
  if(id==='all') displayAll();
  if(id==='pending') displayPending();
  if(id==='stats') displayStats();
  if(id==='sort') document.getElementById('sortedTasksList').innerHTML='<div class="empty-state">Select a sort option.</div>';
}

function addTask(e){
  e.preventDefault();
  const tasks=loadTasks();
  const hours=parseInt(document.getElementById('taskHours').value);
  const deadline=Math.floor((Date.now()/1000)+(hours*3600));
  const t={
    id:Date.now(),
    name:taskName.value,
    description:taskDesc.value,
    priority:+taskPriority.value,
    duration:+taskDuration.value,
    deadline,
    completed:false
  };
  pushUndo();
  tasks.push(t);
  saveTasks(tasks);
  showNotification('Task added!');
  e.target.reset();
}

function createCard(t){
  const overdue=!t.completed && t.deadline<Date.now()/1000;
  return `<div class="task-card ${t.completed?'completed':''} ${overdue?'overdue':''}">
    <div class="task-header">
      <span class="task-title">${t.name}</span>
      <span class="task-priority priority-${t.priority}">P${t.priority}</span>
    </div>
    <p>${t.description}</p>
    <div class="task-meta">
      <div><strong>Deadline:</strong> ${new Date(t.deadline*1000).toLocaleString()}</div>
      <div><strong>Duration:</strong> ${t.duration} min</div>
      <div><strong>Status:</strong> ${t.completed?'Completed':'Pending'} ${overdue?'(Overdue)':''}</div>
    </div>
    <div class="task-actions">
      ${!t.completed?`<button class="btn btn-success" onclick="markDone(${t.id})">‚úÖ Done</button>`:''}
      <button class="btn btn-danger" onclick="delTask(${t.id})">üóë Delete</button>
    </div>
  </div>`;
}

function displayTasks(list,id){
  const c=document.getElementById(id);
  c.innerHTML=list.length?list.map(createCard).join(''):'<div class="empty-state">No tasks here.</div>';
}

function displayAll(){displayTasks(loadTasks(),'allTasksList');}
function displayPending(){displayTasks(loadTasks().filter(t=>!t.completed),'pendingTasksList');}

function markDone(id){
  const t=loadTasks();
  pushUndo();
  const f=t.find(x=>x.id===id);
  if(f){f.completed=true;saveTasks(t);showNotification('Marked completed');displayAll();displayPending();}
}

function delTask(id){
  if(!confirm('Delete this task?')) return;
  const t=loadTasks().filter(x=>x.id!==id);
  pushUndo();
  saveTasks(t);
  showNotification('Task deleted');
  displayAll();displayPending();
}

function displayStats(){
  const t=loadTasks(), total=t.length, comp=t.filter(x=>x.completed).length, pend=total-comp;
  const overdue=t.filter(x=>!x.completed&&x.deadline<Date.now()/1000).length;
  document.getElementById('statsContent').innerHTML=`
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value">${total}</div><div>Total</div></div>
      <div class="stat-card"><div class="stat-value">${comp}</div><div>Completed</div></div>
      <div class="stat-card"><div class="stat-value">${pend}</div><div>Pending</div></div>
      <div class="stat-card"><div class="stat-value">${overdue}</div><div>Overdue</div></div>
    </div>`;
}

function sortTasks(key){
  const t=loadTasks().slice().sort((a,b)=>a[key]-b[key]);
  displayTasks(t,'sortedTasksList');
  showNotification(`Sorted by ${key}`);
}

function undo(){
  if(!undoStack.length){showNotification('Nothing to undo','error');return;}
  redoStack.push(loadTasks());
  const prev=undoStack.pop();
  saveTasks(prev);
  showNotification('Undo done');
  displayAll();
}

function redo(){
  if(!redoStack.length){showNotification('Nothing to redo','error');return;}
  undoStack.push(loadTasks());
  const next=redoStack.pop();
  saveTasks(next);
  showNotification('Redo done');
  displayAll();
}

window.onload=()=>displayAll();
</script>
</body>
</html>
